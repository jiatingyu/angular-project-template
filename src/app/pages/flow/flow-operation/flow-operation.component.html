<form nz-form [formGroup]="searchForm" [nzLayout]="'inline'">
  <nz-form-item>
    <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="account">名称</nz-form-label>
    <nz-form-control [nzSm]="14" [nzXs]="24">
      <input nz-input formControlName="name" />
    </nz-form-control>
  </nz-form-item>
  <nz-form-item>
    <nz-form-control>
      <button nz-button nzType="primary" (click)="loadData()">搜索</button>
    </nz-form-control>
  </nz-form-item>
</form>
<nz-card [nzTitle]="list">
  <nz-table
    #basicTable
    [nzData]="dataSet"
    [nzSize]="'small'"
    [nzFrontPagination]="false"
    [nzTotal]="pageObj.total"
    [(nzPageIndex)]="pageObj.page"
    [(nzPageSize)]="pageObj.size"
    [nzLoading]="loading"
    (nzPageIndexChange)="loadData()"
  >
    <thead>
      <tr>
        <th
          nzLeft
          nzWidth="30px"
          nzShowCheckbox
          [(nzChecked)]="isAllDisplayDataChecked"
          [nzIndeterminate]="isIndeterminate"
          (nzCheckedChange)="checkAll($event)"
        ></th>
        <th>id</th>
        <th>审批名称</th>
        <th>用户姓名</th>
        <th>用户身份证</th>
        <th>用户所在部门</th>
        <th>发起人</th>
        <th>管控措施</th>
        <th>备注</th>
        <th>发起时间</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of basicTable.data; index as i">
        <td nzLeft nzShowCheckbox [(nzChecked)]="data.checked" (nzCheckedChange)="itemCheckedChange()"></td>
        <td>{{ data.id }}</td>
        <td>{{ data.name }}</td>
        <!-- <td>{{ data.metaInfo | json }}</td> -->
        <td>{{ data.workFlowVo?.name }}</td>
        <td>{{ data.workFlowVo?.idCard }}</td>
        <td>{{ data.workFlowVo?.deptName }}</td>
        <td>{{ data.workFlowVo?.userName }}</td>
        <td>{{ data.workFlowVo?.gkcs }}</td>
        <td>{{ data.workFlowVo?.content }}</td>
        <td>{{ data.workFlowVo?.createTime | date: 'YYYY-MM-dd hh:mm:ss' }}</td>
      </tr>
    </tbody>
  </nz-table>
  <ng-template #list>
    <div nz-row nzType="flex" nzJustify="space-between">
      <div>
        <nz-space>
          <button *nzSpaceItem nz-button nzType="primary" (click)="loadData()">
            <i nz-icon nzType="fire" nzTheme="outline"></i>刷新
          </button>
          <button *nzSpaceItem [disabled]="getCheckData().length === 0" nz-button nzType="primary" (click)="check()">
            <i nz-icon nzType="fire" nzTheme="outline"></i>审核
          </button>
        </nz-space>
      </div>
    </div>
  </ng-template>
</nz-card>

<nz-modal [(nzVisible)]="checkVisible" nzTitle="审批" (nzOnCancel)="checkVisible = !checkVisible" (nzOnOk)="handleCheck()">
  <ng-container *nzModalContent>
    <form nz-form [formGroup]="checkForm">
      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="flag">审批意见</nz-form-label>
        <nz-form-control [nzSm]="14" [nzXs]="24">
          <nz-select style="width: 100%" formControlName="flag" nzShowSearch nzAllowClear nzPlaceHolder="审批意见">
            <nz-option nzLabel="同意" [nzValue]="1"></nz-option>
            <nz-option nzLabel="驳回" [nzValue]="0"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="comment">备注</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="comment" id="comment" />
        </nz-form-control>
      </nz-form-item>
    </form>
  </ng-container>
</nz-modal>
